<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ููุญุฉ ููุงู ุฏุงุฎููุฉ ููุฃุฎุตุงุฆููู ูุน ุญูุธ ูุญูู ููููุงู ูุงูุญุงูุฉ.">
    <meta name="author" content="ูุฑูุฒ ุงูุฃุนูุงู ุงูุนุฑุจู">
    <link rel="canonical" href="https://arab-business-hub.com/dashboard.html">
    <meta property="og:title" content="ููุญุฉ ุงูููุงู - ูุฑูุฒ ุงูุฃุนูุงู ุงูุนุฑุจู">
    <meta property="og:description" content="ุฅุฏุงุฑุฉ ุงูููุงูุ ุงูุชุนูููุงุชุ ูุฑูุงุจุท ุงูุชุณููู ูุน ุญูุธ ูุญูู ููุฃุฎุตุงุฆููู.">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_AR">
    <meta property="og:url" content="https://arab-business-hub.com/dashboard.html">
    <meta property="og:image" content="https://arab-business-hub.com/og-image.svg">
    <meta property="og:site_name" content="ูุฑูุฒ ุงูุฃุนูุงู ุงูุนุฑุจู">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="ููุญุฉ ุงูููุงู - ูุฑูุฒ ุงูุฃุนูุงู ุงูุนุฑุจู">
    <meta name="twitter:description" content="ุจูุงุจุฉ ููุงู ุฏุงุฎููุฉ ููุฃุฎุตุงุฆููู ูุน ุญูุธ ูู ุงููุชุตูุญ.">
    <meta name="twitter:image" content="https://arab-business-hub.com/og-image.svg">
    <title>ููุญุฉ ุงูููุงู - ูุฑูุฒ ุงูุฃุนูุงู ุงูุนุฑุจู</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="favicon.svg">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header class="site-header">
        <nav class="navbar">
            <div class="container">
                <div class="nav-brand">
                    <h1>ูุฑูุฒ ุงูุฃุนูุงู ุงูุนุฑุจู</h1>
                </div>
                <button class="nav-toggle" id="navToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <ul class="nav-menu" id="navMenu">
                    <li><a href="index.html">ุงูุฑุฆูุณูุฉ</a></li>
                    <li><a href="services.html">ุงูุฎุฏูุงุช</a></li>
                    <li><a href="about.html">ูู ูุญู</a></li>
                    <li><a href="pricing.html">ุงูุฃุณุนุงุฑ</a></li>
                    <li><a href="contact.html">ุงุชุตู ุจูุง</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <section class="page-header">
            <div class="container">
                <h1>ููุญุฉ ุงูููุงู ุงูุฏุงุฎููุฉ</h1>
                <p>ุฅุฏุงุฑุฉ ุงูููุงูุ ุงูุงุณุชูุงูุ ูุงูููุงุญุธุงุช ูุน ุญูุธ ูุญูู ูู ูุชุตูุญู.</p>
            </div>
        </section>

        <section class="dashboard-section">
            <div class="container">
                <div class="dashboard-grid">
                    <div class="dashboard-card" id="accessCard">
                        <h2>ุจูุงุจุฉ ุงูุฏุฎูู</h2>
                        <p class="lead">ุฃุฏุฎู ุฑูุฒ ุงููุตูู ูุงุณุชุนุฑุงุถ ุงูููุงู. ูุชู ุญูุธ ุงูุฑูุฒ ูุญููุงู ูุชุณููู ุงูุฏุฎูู ูุงุญูุงู.</p>
                        <form class="access-form" id="accessForm">
                            <input type="password" id="accessCode" placeholder="ุฑูุฒ ุงูุฏุฎูู" required>
                            <button type="submit" class="btn btn-primary">ุฏุฎูู</button>
                            <button type="button" id="resetAccess" class="btn btn-secondary">ุฅุนุงุฏุฉ ุชุนููู</button>
                        </form>
                        <div class="dashboard-card" id="preLoginDiagnostics">
                            <div class="access-header">
                                <h3>ูุญุต ูุจู ุงูุฏุฎูู</h3>
                                <p class="inline-help">๐ ูุธูุฑ ูุง ุณูุชู ุงูุชุญูู ููู ูุจู ุชุณุฌูู ุงูุฏุฎูู.</p>
                            </div>
                            <ul class="code-list">
                                <li class="code-item"><strong>ุงููููุฉ ุจุนุฏ ุงูุชุทุจูุน:</strong> <span id="normalizedPreview"></span></li>
                                <li class="code-item"><strong>ุนุฏุฏ ุฃููุงุฏ ุงูุฏุฎูู:</strong> <span id="accessCodeCount"></span></li>
                                <li class="code-item"><strong>ููุชุงุญ ุงูุชุฎุฒูู:</strong> <span id="storageKeyPreview"></span></li>
                            </ul>
                        </div>
                        <p class="inline-note">ูุง ูุชู ุฅุฑุณุงู ุฃู ุจูุงูุงุช ูุฎุงุฏู ุฎุงุฑุฌู.</p>
                    </div>

                    <div class="dashboard-card" id="dashboardPanel" style="display:none;">
                        <div class="panel-header">
                            <div>
                                <h2>ููุญุฉ ุงูููุงู</h2>
                                <p class="lead">ุชุญุฏูุซ ุงูุญุงูุงุชุ ุงุณุชูุงู ุงูููุงูุ ูุฅุถุงูุฉ ุฑูุงุจุท ุงูุชุณููู. ูู ุดูุก ูุญููุธ ูุญููุงู.</p>
                                <p class="inline-help">๐ก ููุชุนุงูู ุงูุณุฑูุน: ุงุณุชุฎุฏู ุงูุจุญุซุ ุงูููุงุชุฑุ ูุชูุงุฑูุฎ ุงูุชุญุฏูุซ ููุนุฑูุฉ ุฃุญุฏุซ ุงูุชุบููุฑุงุช.</p>
                            </div>
                            <div class="admin-toggle-area">
                                <button type="button" class="btn btn-secondary btn-small" id="adminToggle">ุชูุนูู ูุถุน ุงููุดุฑู</button>
                                <span class="admin-mode-badge" id="adminModeBadge">ูุถุน ุงููุดุฑู ููุนูู</span>
                            </div>
                        </div>

                        <div class="task-controls">
                            <input type="text" id="newTitle" placeholder="ุนููุงู ุงููููุฉ" aria-label="ุนููุงู ุงููููุฉ">
                            <input type="text" id="newOwner" placeholder="ุงููุงูู ุฃู ุงููุฑูู" aria-label="ุงููุงูู ุฃู ุงููุฑูู">
                            <select id="newStatus" aria-label="ุงูุญุงูุฉ">
                                <option value="New">ุฌุฏูุฏุฉ</option>
                                <option value="Assigned">ููุณูุฏุฉ</option>
                                <option value="In Progress">ููุฏ ุงูุชูููุฐ</option>
                                <option value="Review">ูุฑุงุฌุนุฉ</option>
                                <option value="Delivered">ุชู ุงูุชุณููู</option>
                            </select>
                            <select id="newAssignee" aria-label="ุชุนููู ุฅูู">
                                <option value="">ุบูุฑ ูุณูุฏุฉ</option>
                                <option value="ุฃุญูุฏ">ุฃุญูุฏ</option>
                                <option value="ุณุงุฑุฉ">ุณุงุฑุฉ</option>
                                <option value="ูููู">ูููู</option>
                                <option value="ุฎุงูุฏ">ุฎุงูุฏ</option>
                                <option value="ููุง">ููุง</option>
                                <option value="ููุณู">ููุณู</option>
                            </select>
                            <input type="text" id="claimName" placeholder="ุงุณูู ููุงุณุชูุงู" aria-label="ุงุณูู ููุงุณุชูุงู">
                            <button type="button" id="addTask" class="btn btn-secondary btn-small">ุฅุถุงูุฉ ูููุฉ</button>
                        </div>

                        <div class="status-summary" aria-label="ููุฎุต ุงูุญุงูุงุช">
                            <button class="status-chip" data-status="" aria-label="ุนุฑุถ ูู ุงูููุงู">
                                <div class="chip-label"><span class="chip-icon">๐</span><span>ุงููู</span></div>
                                <strong id="countAll">0</strong>
                            </button>
                            <button class="status-chip" data-status="New">
                                <div class="chip-label"><span class="chip-icon">๐</span><span>ุฌุฏูุฏุฉ</span></div>
                                <strong id="countNew">0</strong>
                            </button>
                            <button class="status-chip" data-status="In Progress">
                                <div class="chip-label"><span class="chip-icon">โณ</span><span>ููุฏ ุงูุชูููุฐ</span></div>
                                <strong id="countInProgress">0</strong>
                            </button>
                            <button class="status-chip" data-status="Review">
                                <div class="chip-label"><span class="chip-icon">๐ง</span><span>ูุฑุงุฌุนุฉ</span></div>
                                <strong id="countReview">0</strong>
                            </button>
                            <button class="status-chip" data-status="Delivered">
                                <div class="chip-label"><span class="chip-icon">โ</span><span>ุชู ุงูุชุณููู</span></div>
                                <strong id="countDelivered">0</strong>
                            </button>
                        </div>

                        <div class="filter-controls" aria-label="ุนูุงูู ุชุตููุฉ ุงูููุงู">
                            <div class="filter-group">
                                <label for="searchBox">ุจุญุซ ุณุฑูุน</label>
                                <input type="search" id="searchBox" placeholder="ุงูุนููุงูุ ุงููุณุคููุ ุงูููุงุญุธุงุช" aria-label="ุจุญุซ ุณุฑูุน">
                            </div>
                            <div class="filter-group">
                                <label for="statusFilter">ุชุตููุฉ ุญุณุจ ุงูุญุงูุฉ</label>
                                <select id="statusFilter">
                                    <option value="">ุงููู</option>
                                    <option value="New">ุฌุฏูุฏุฉ</option>
                                    <option value="Assigned">ููุณูุฏุฉ</option>
                                    <option value="In Progress">ููุฏ ุงูุชูููุฐ</option>
                                    <option value="Review">ูุฑุงุฌุนุฉ</option>
                                    <option value="Delivered">ุชู ุงูุชุณููู</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="assigneeFilter">ุญุณุจ ุงููุณุคูู / ุงููุงูู</label>
                                <select id="assigneeFilter" aria-label="ุชุตููุฉ ุญุณุจ ุงููุณุคูู">
                                    <option value="">ุงููู</option>
                                    <option value="__unassigned">ุบูุฑ ูุณูุฏุฉ</option>
                                    <option value="ุฃุญูุฏ">ุฃุญูุฏ</option>
                                    <option value="ุณุงุฑุฉ">ุณุงุฑุฉ</option>
                                    <option value="ูููู">ูููู</option>
                                    <option value="ุฎุงูุฏ">ุฎุงูุฏ</option>
                                    <option value="ููุง">ููุง</option>
                                    <option value="ููุณู">ููุณู</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="sortBy">ุชุฑุชูุจ</label>
                                <select id="sortBy">
                                    <option value="recent">ุงูุฃุญุฏุซ ุชุญุฏูุซุงู</option>
                                    <option value="newest">ุงูุฃุญุฏุซ ุฅุถุงูุฉ</option>
                                    <option value="oldest">ุงูุฃูุฏู</option>
                                </select>
                            </div>
                        </div>

                        <div class="view-switch-help">
                            <p class="inline-help">๐ฑ ูู ุงูุดุงุดุงุช ุงูุตุบูุฑุฉ ุชุธูุฑ ุงูููุงู ูุจุทุงูุงุชุ ูุนูู ุงูุญุงุณูุจ ุชุจูู ูู ุฌุฏูู ููุธู.</p>
                        </div>

                        <div class="admin-task-board" id="adminTaskBoard" style="display:none;">
                            <div class="admin-board-header">
                                <div>
                                    <h3>ุฅุฏุงุฑุฉ ุงูููุงู</h3>
                                    <p class="inline-help">ุนุฑุถ ุณุฑูุน ููููุงู ุจุญุณุจ ุงูุฃุฎุตุงุฆู ุงููุณุคูู ูุน ุฅุจุฑุงุฒ ุงูููุงู ุบูุฑ ุงููุณูุฏุฉ.</p>
                                </div>
                                <span class="admin-note">ูุฑุฆู ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู</span>
                            </div>
                            <div class="admin-group-list" id="adminGroupList"></div>
                        </div>

                        <div class="task-cards" id="taskCards" aria-live="polite"></div>

                        <table class="task-table" aria-live="polite">
                            <thead>
                                <tr>
                                    <th>ุงููููุฉ</th>
                                    <th>ุงูุญุงูุฉ</th>
                                    <th>ุงููุณุคูู</th>
                                    <th>ููุงุญุธุงุช</th>
                                    <th>ุฑุงุจุท ุงูุชุณููู</th>
                                    <th>ุขุฎุฑ ุชุญุฏูุซ</th>
                                    <th>ุฅุฌุฑุงุก</th>
                                </tr>
                            </thead>
                            <tbody id="taskBody"></tbody>
                        </table>

                        <div class="backup-area">
                            <div class="backup-actions">
                                <div class="apply-actions">
                                    <button type="button" id="exportTasks" class="btn btn-secondary btn-small">ุชุตุฏูุฑ JSON</button>
                                    <button type="button" id="downloadTasks" class="btn btn-secondary btn-small">ุชูุฒูู ููู JSON</button>
                                    <button type="button" id="importTasks" class="btn btn-primary btn-small">ุงุณุชูุฑุงุฏ JSON</button>
                                    <label for="uploadFile" class="btn btn-primary btn-small file-label">ุฑูุน ููู JSON</label>
                                    <input type="file" id="uploadFile" accept="application/json" aria-label="ุฑูุน ููู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ">
                                </div>
                                <p class="inline-help">โฉ๏ธ ุนูุฏ ุงูุชุนุฏูู ุฃู ุงูุชุณููู ูุชู ุชุญุฏูุซ ุงูุชูููุช ุชููุงุฆูุงู ูุถูุงู ุงููุชุงุจุนุฉ.</p>
                            </div>
                            <textarea id="backupText" placeholder="ุฃูุตู ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ููุง ุฃู ุงูุณุฎ ุงูุจูุงูุงุช ุงูุญุงููุฉ."></textarea>
                            <p class="inline-note">ุงููุณุฎ ุงูุงุญุชูุงุทู ูุญูู ููุท ููุงุญุชูุงุธ ุจุชูุฏู ุงููุฑูู.</p>
                            <div class="error-text" id="importError" role="alert" aria-live="assertive"></div>
                        </div>

                        <div class="access-mgmt" id="accessMgmt" aria-live="polite">
                            <div class="access-header">
                                <h3>ุฃููุงุฏ ุงูุฏุฎูู (ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู)</h3>
                                <p class="inline-help">๐ ููุงุณุชุฎุฏุงู ุงูุฏุงุฎูู ููุท. ุงูุณุฎ ุงูููุฏ ุงูููุงุณุจ ูุดุงุฑูู ุจุฃูุงู.</p>
                                <button type="button" id="copyAllCodes" class="btn btn-secondary btn-small">ูุณุฎ ุงููู</button>
                                <span class="copy-status" id="copyStatus"></span>
                            </div>
                            <ul class="code-list" id="accessCodesList"></ul>
                        </div>

                        <div class="dashboard-card admin-code-card" id="adminCodeSection" style="display:none;">
                            <div class="access-header">
                                <h3>ุฑูุฒ ูุถุน ุงููุดุฑู</h3>
                                <p class="inline-help">โ๏ธ ุงุญุชูุธ ุจูุฐุง ุงูุฑูุฒ ูู ููุงู ุขูู. ูุณูุญ ุจุชูุนูู ุฃุฏูุงุช ุงููุดุฑู.</p>
                            </div>
                            <div class="admin-code-row">
                                <span class="admin-code-value" id="adminCodeValue"></span>
                                <button type="button" class="btn btn-primary btn-small" id="copyAdminCode">ูุณุฎ ุงูุฑูุฒ</button>
                            </div>
                            <span class="copy-status" id="adminCopyStatus"></span>
                        </div>

                        <div class="dashboard-card" id="accessDiagnostics" style="display:none;">
                            <div class="access-header">
                                <h3>ูุญุต ุงููุตูู</h3>
                                <p class="inline-help">โ๏ธ ูุนูููุงุช ุณุฑูุนุฉ ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู ููุชุฃูุฏ ูู ุฃู ุงูุฃููุงุฏ ุชุนูู ููุง ูุฌุจ.</p>
                            </div>
                            <ul class="code-list" id="diagnosticsList"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>ูุฑูุฒ ุงูุฃุนูุงู ุงูุนุฑุจู</h3>
                    <p>ุดุฑููู ูู ุงููุฌุงุญ ุงูุฑููู</p>
                </div>
                <div class="footer-section">
                    <h4>ุฑูุงุจุท ุณุฑูุนุฉ</h4>
                    <ul>
                        <li><a href="index.html">ุงูุฑุฆูุณูุฉ</a></li>
                        <li><a href="services.html">ุงูุฎุฏูุงุช</a></li>
                        <li><a href="about.html">ูู ูุญู</a></li>
                        <li><a href="pricing.html">ุงูุฃุณุนุงุฑ</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>ุงูุฎุฏูุงุช</h4>
                    <ul>
                        <li><a href="services.html#branding">ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ</a></li>
                        <li><a href="services.html#web">ุงููููุน ุงูุฅููุชุฑููู</a></li>
                        <li><a href="services.html#marketing">ุงูุชุณููู ูุงูููู</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>ููุฃุฎุตุงุฆููู</h4>
                    <p>ูุนูู ูุน ูุชูุงุจุ ูุณูููููุ ููุฏูุฑู ูุดุงุฑูุน ูุชูููุฐ ุงูุนูู ูุนููุงุฆูุง.</p>
                    <div class="footer-actions">
                        <a href="apply.html" class="btn btn-primary btn-small">ุงูุชุณุฌูู ููุนูู ูุนูุง</a>
                        <a href="dashboard.html" class="btn btn-secondary btn-small">ููุญุฉ ุงูููุงู</a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>ุชูุงุตู ูุนูุง</h4>
                    <ul>
                        <li><a href="contact.html">ูููุฐุฌ ุงูุงุชุตุงู</a></li>
                        <li><a href="mailto:info@arab-business-hub.com">info@arab-business-hub.com</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 ูุฑูุฒ ุงูุฃุนูุงู ุงูุนุฑุจู. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
            </div>
        </div>
    </footer>

    <script src="js/script.js"></script>
    <script>
        (function() {
            const normalizeCode = (value) => {
                const dashNormalized = (value || '').replace(/[โโโโโโ๏นฃ๏ผ]/g, '-');
                return dashNormalized.trim().toUpperCase();
            };
            const normalizeName = (value) => (value || '').trim().toLowerCase();

            const ADMIN_MODE_CODE = 'ABH-ADMIN-2024';
            const ACCESS_CODES = Object.freeze([
                'ABH-94K2-7XM',
                'ABH-57GQ-29N',
                'ABH-81PV-4T3',
                'ABH-63WD-8YL',
                'ABH-10CR-5ZU',
                'ABH-46MN-2QS'
            ].map(normalizeCode));
            const ACCESS_KEY = 'abh_access_code';
            const TASK_KEY = 'abh_dashboard_tasks';
            const EXPORT_VERSION = '1.0.0';
            const SPECIALISTS = ['ุฃุญูุฏ', 'ุณุงุฑุฉ', 'ูููู', 'ุฎุงูุฏ', 'ููุง', 'ููุณู'];
            const statusLabels = {
                'New': 'ุฌุฏูุฏุฉ',
                'Assigned': 'ููุณูุฏุฉ',
                'In Progress': 'ููุฏ ุงูุชูููุฐ',
                'Review': 'ูุฑุงุฌุนุฉ',
                'Delivered': 'ุชู ุงูุชุณููู'
            };

            const accessCard = document.getElementById('accessCard');
            const dashboardPanel = document.getElementById('dashboardPanel');
            const accessForm = document.getElementById('accessForm');
            const accessCodeInput = document.getElementById('accessCode');
            const resetAccess = document.getElementById('resetAccess');
            const taskBody = document.getElementById('taskBody');
            const taskCards = document.getElementById('taskCards');
            const newTitle = document.getElementById('newTitle');
            const newOwner = document.getElementById('newOwner');
            const newStatus = document.getElementById('newStatus');
            const newAssignee = document.getElementById('newAssignee');
            const addTaskBtn = document.getElementById('addTask');
            const claimNameInput = document.getElementById('claimName');
            const exportBtn = document.getElementById('exportTasks');
            const downloadBtn = document.getElementById('downloadTasks');
            const importBtn = document.getElementById('importTasks');
            const uploadFile = document.getElementById('uploadFile');
            const backupText = document.getElementById('backupText');
            const importError = document.getElementById('importError');
            const statusFilter = document.getElementById('statusFilter');
            const assigneeFilter = document.getElementById('assigneeFilter');
            const searchBox = document.getElementById('searchBox');
            const sortBy = document.getElementById('sortBy');
            const adminToggle = document.getElementById('adminToggle');
            const adminModeBadge = document.getElementById('adminModeBadge');
            const adminGroupList = document.getElementById('adminGroupList');
            const adminTaskBoard = document.getElementById('adminTaskBoard');
            const adminCodeSection = document.getElementById('adminCodeSection');
            const adminCodeValue = document.getElementById('adminCodeValue');
            const adminCopyStatus = document.getElementById('adminCopyStatus');
            const copyAdminCodeBtn = document.getElementById('copyAdminCode');
            const accessCodesList = document.getElementById('accessCodesList');
            const copyAllCodesBtn = document.getElementById('copyAllCodes');
            const copyStatus = document.getElementById('copyStatus');
            const accessDiagnostics = document.getElementById('accessDiagnostics');
            const diagnosticsList = document.getElementById('diagnosticsList');
            const normalizedPreview = document.getElementById('normalizedPreview');
            const accessCodeCount = document.getElementById('accessCodeCount');
            const storageKeyPreview = document.getElementById('storageKeyPreview');
            const statusChips = Array.from(document.querySelectorAll('.status-chip'));
            const counters = {
                All: document.getElementById('countAll'),
                New: document.getElementById('countNew'),
                'In Progress': document.getElementById('countInProgress'),
                Review: document.getElementById('countReview'),
                Delivered: document.getElementById('countDelivered')
            };

            if (adminCodeValue) {
                adminCodeValue.textContent = ADMIN_MODE_CODE;
            }

            let adminMode = false;

            function isValidAccessCode(input) {
                const normalizedInput = normalizeCode(input);
                return ACCESS_CODES.includes(normalizedInput);
            }

            function isValidAdminCode(code) {
                return normalizeCode(code) === normalizeCode(ADMIN_MODE_CODE);
            }

            function loadTasks() {
                try {
                    const saved = localStorage.getItem(TASK_KEY);
                    if (saved) {
                        return JSON.parse(saved).map(task => normalizeTask(task));
                    }
                } catch (e) {
                    console.warn('ุชุนุฐุฑ ูุฑุงุกุฉ ุงูููุงู ูู ุงูุชุฎุฒูู ุงููุญูู', e);
                }
                return [
                    normalizeTask({ id: Date.now(), title: 'ุชุญุฏูุซ ุตูุญุฉ ุงูุฎุฏูุงุช', owner: 'ูุฑูู ุงููุญุชูู', status: 'New', assignee: '', notes: '', reviewerNotes: '', link: '' }),
                    normalizeTask({ id: Date.now() + 1, title: 'ุฅุนุฏุงุฏ ุญููุฉ ุฅุทูุงู', owner: 'ุงูุชุณููู', status: 'Assigned', assignee: 'ุฃุญูุฏ', notes: 'ุญุงุฌุฉ ูุชุฃููุฏ ุงูููุฒุงููุฉ', reviewerNotes: '', link: '' })
                ];
            }

            function normalizeTask(task) {
                if (task.assignedTo && !task.assignee) {
                    task.assignee = task.assignedTo;
                }
                if (!task.assignee) {
                    task.assignee = '';
                }
                if (!task.lastUpdated) {
                    task.lastUpdated = new Date().toISOString();
                }
                if (!task.reviewerNotes) {
                    task.reviewerNotes = '';
                }
                if (!task.link) {
                    task.link = '';
                }
                return task;
            }

            function touchTask(task) {
                task.lastUpdated = new Date().toISOString();
            }

            let tasks = loadTasks();

            setAdminMode(false);
            renderPreLoginDiagnostics();

            function saveTasks() {
                localStorage.setItem(TASK_KEY, JSON.stringify(tasks));
            }

            function persistAndRender() {
                saveTasks();
                renderTasks();
            }

            function getStoredAccessCode() {
                return normalizeCode(localStorage.getItem(ACCESS_KEY));
            }

            function persistAccessCode(code) {
                localStorage.setItem(ACCESS_KEY, normalizeCode(code));
            }

            function hasAccess() {
                return isValidAccessCode(getStoredAccessCode());
            }

            function showDashboard() {
                accessCard.style.display = 'none';
                dashboardPanel.style.display = 'block';
                renderAccessCodes();
                renderTasks();
                renderAccessDiagnostics();
            }

            function showGate() {
                accessCard.style.display = 'block';
                dashboardPanel.style.display = 'none';
                setAdminMode(false);
            }

            function formatDate(value) {
                if (!value) return '';
                try {
                    return new Date(value).toLocaleString('ar-EG');
                } catch (e) {
                    return value;
                }
            }

            function createStatusBadge(status) {
                const badge = document.createElement('span');
                badge.className = `status-badge status-${status.replace(/\s+/g,'-').toLowerCase()}`;
                const icons = {
                    'New': '๐',
                    'Assigned': '๐งญ',
                    'In Progress': 'โณ',
                    'Review': '๐ง',
                    'Delivered': 'โ'
                };
                badge.textContent = `${icons[status] || ''} ${statusLabels[status] || status}`;
                return badge;
            }

            function currentUser() {
                return claimNameInput.value.trim();
            }

            function userMatchesAssignee(task) {
                return task.assignee && normalizeName(task.assignee) === normalizeName(currentUser());
            }

            function canEditTask(task) {
                if (adminMode) return true;
                return !!task.assignee && userMatchesAssignee(task);
            }

            function canClaimTask(task) {
                if (adminMode) return true;
                if (!task.assignee) return false;
                return userMatchesAssignee(task);
            }

            function buildSpecialistOptions(selectEl, selectedValue = '') {
                selectEl.innerHTML = '';
                const emptyOption = document.createElement('option');
                emptyOption.value = '';
                emptyOption.textContent = 'ุบูุฑ ูุณูุฏุฉ';
                selectEl.appendChild(emptyOption);

                SPECIALISTS.forEach(name => {
                    const option = document.createElement('option');
                    option.value = name;
                    option.textContent = name;
                    selectEl.appendChild(option);
                });

                if (selectedValue && !SPECIALISTS.includes(selectedValue)) {
                    const customOption = document.createElement('option');
                    customOption.value = selectedValue;
                    customOption.textContent = selectedValue;
                    selectEl.appendChild(customOption);
                }

                selectEl.value = selectedValue || '';
            }

            function refreshAssigneeFilterOptions() {
                const currentValue = assigneeFilter.value;
                const uniqueNames = Array.from(new Set([
                    ...SPECIALISTS,
                    ...tasks.filter(t => t.assignee).map(t => t.assignee.trim())
                ])).filter(Boolean);

                assigneeFilter.innerHTML = '';
                const allOption = document.createElement('option');
                allOption.value = '';
                allOption.textContent = 'ุงููู';
                assigneeFilter.appendChild(allOption);

                const unassignedOption = document.createElement('option');
                unassignedOption.value = '__unassigned';
                unassignedOption.textContent = 'ุบูุฑ ูุณูุฏุฉ';
                assigneeFilter.appendChild(unassignedOption);

                uniqueNames.forEach(name => {
                    const opt = document.createElement('option');
                    opt.value = name;
                    opt.textContent = name;
                    assigneeFilter.appendChild(opt);
                });

                if (currentValue && Array.from(assigneeFilter.options).some(opt => opt.value === currentValue)) {
                    assigneeFilter.value = currentValue;
                }
            }

            function claimTask(task) {
                if (!task.assignee) {
                    alert('ูุฐู ุงููููุฉ ุบูุฑ ูุณูุฏุฉ. ูุฑุฌู ุชุนููู ูุณุคูู ูุจู ุงูุจุฏุก.');
                    return;
                }
                const claimer = currentUser() || prompt('ุฃุฏุฎู ุงุณูู ููุงุณุชูุงู ููู ุงูุชุนููู ุงููุณุฌูู');
                if (!claimer) return;
                claimNameInput.value = claimer;
                if (!canClaimTask(task)) {
                    alert('ููุท ุงูุฃุฎุตุงุฆู ุงููุนููู ููููู ุงุณุชูุงู ูุฐู ุงููููุฉ.');
                    return;
                }
                task.status = task.status === 'Delivered' ? 'Delivered' : 'In Progress';
                touchTask(task);
                persistAndRender();
            }

            function unclaimTask(task) {
                if (!adminMode && !userMatchesAssignee(task)) {
                    alert('ูููู ุฅูุบุงุก ุงูุงุณุชูุงู ููุท ูู ูุจู ููุณ ุงููุณุคูู ุฃู ูู ูุถุน ุงููุดุฑู.');
                    return;
                }
                task.assignee = '';
                touchTask(task);
                persistAndRender();
            }

            function deleteTask(task) {
                const confirmed = confirm('ุชุฃููุฏ ุญุฐู ุงููููุฉุ ูู ูููู ุงูุชุฑุงุฌุน.');
                if (confirmed) {
                    tasks = tasks.filter(t => t.id !== task.id);
                    persistAndRender();
                }
            }

            function buildTaskActions(task) {
                const wrap = document.createElement('div');
                wrap.className = 'action-stack';

                const claimButton = document.createElement('button');
                claimButton.type = 'button';
                claimButton.className = 'btn btn-primary btn-small';
                claimButton.textContent = 'ุงุณุชูุงู';
                claimButton.addEventListener('click', () => claimTask(task));
                claimButton.disabled = !canClaimTask(task);

                const unclaimButton = document.createElement('button');
                unclaimButton.type = 'button';
                unclaimButton.className = 'btn btn-secondary btn-small';
                unclaimButton.textContent = 'ุฅูุบุงุก ุงูุงุณุชูุงู';
                unclaimButton.addEventListener('click', () => unclaimTask(task));
                unclaimButton.disabled = !canEditTask(task);

                const deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.className = 'btn btn-danger btn-small';
                deleteButton.textContent = 'ุญุฐู';
                deleteButton.addEventListener('click', () => deleteTask(task));
                deleteButton.disabled = !adminMode;

                wrap.append(claimButton, unclaimButton, deleteButton);
                return wrap;
            }

            function renderTasks() {
                taskBody.innerHTML = '';
                taskCards.innerHTML = '';
                importError.textContent = '';
                refreshAssigneeFilterOptions();

                const filtered = tasks
                    .slice()
                    .sort((a, b) => {
                        if (sortBy.value === 'newest') return b.id - a.id;
                        if (sortBy.value === 'oldest') return a.id - b.id;
                        return new Date(b.lastUpdated || 0) - new Date(a.lastUpdated || 0);
                    })
                    .filter(task => {
                        const statusMatch = statusFilter.value ? task.status === statusFilter.value : true;
                        const assigneeTerm = assigneeFilter.value.trim();
                        const assigneeMatch = assigneeTerm ? (assigneeTerm === '__unassigned' ? !task.assignee : normalizeName(task.assignee) === normalizeName(assigneeTerm)) : true;
                        const searchTerm = searchBox.value.trim();
                        const searchMatch = searchTerm ? [task.title, task.assignee, task.owner, task.notes, task.reviewerNotes].some(val => (val || '').toLowerCase().includes(searchTerm.toLowerCase())) : true;
                        return statusMatch && assigneeMatch && searchMatch;
                    });

                filtered.forEach((task) => {
                    const editable = canEditTask(task);
                    const claimable = canClaimTask(task);
                    const isUnassigned = !task.assignee;
                    // Table row
                    const row = document.createElement('tr');
                    if (isUnassigned) {
                        row.classList.add('unassigned-row');
                    }

                    const titleCell = document.createElement('td');
                    titleCell.innerHTML = `<strong>${task.title}</strong><br><span class="inline-note">${task.owner || ''}</span>`;
                    row.appendChild(titleCell);

                    const statusCell = document.createElement('td');
                    const statusSelect = document.createElement('select');
                    ['New','Assigned','In Progress','Review','Delivered'].forEach(val => {
                        const option = document.createElement('option');
                        option.value = val;
                        option.textContent = statusLabels[val];
                        if (val === task.status) option.selected = true;
                        statusSelect.appendChild(option);
                    });
                    statusSelect.addEventListener('change', () => {
                        task.status = statusSelect.value;
                        touchTask(task);
                        persistAndRender();
                    });
                    statusSelect.disabled = !editable;
                    statusCell.appendChild(statusSelect);
                    row.appendChild(statusCell);

                    const assigneeCell = document.createElement('td');
                    const assigneeInput = document.createElement('select');
                    buildSpecialistOptions(assigneeInput, task.assignee || '');
                    assigneeInput.disabled = !adminMode;
                    assigneeInput.addEventListener('change', () => {
                        task.assignee = assigneeInput.value.trim();
                        touchTask(task);
                        persistAndRender();
                    });
                    assigneeCell.appendChild(assigneeInput);
                    row.appendChild(assigneeCell);

                    const notesCell = document.createElement('td');
                    const notesArea = document.createElement('textarea');
                    notesArea.rows = 3;
                    notesArea.value = task.notes || '';
                    notesArea.placeholder = 'ููุงุญุธุงุช ุฃู ุทูุจุงุช ูุฑุงุฌุนุฉ';
                    notesArea.addEventListener('change', () => {
                        task.notes = notesArea.value.trim();
                        touchTask(task);
                        persistAndRender();
                    });
                    notesArea.disabled = !editable;
                    notesCell.appendChild(notesArea);

                    if (task.status === 'Review') {
                        const reviewerArea = document.createElement('textarea');
                        reviewerArea.rows = 2;
                        reviewerArea.className = 'review-notes';
                        reviewerArea.placeholder = 'ููุงุญุธุงุช ุงููุฑุงุฌุน';
                        reviewerArea.value = task.reviewerNotes || '';
                        reviewerArea.addEventListener('change', () => {
                            task.reviewerNotes = reviewerArea.value.trim();
                            touchTask(task);
                            persistAndRender();
                        });
                        reviewerArea.disabled = !editable;
                        notesCell.appendChild(reviewerArea);
                    }
                    row.appendChild(notesCell);

                    const linkCell = document.createElement('td');
                    const linkInput = document.createElement('input');
                    linkInput.type = 'url';
                    linkInput.value = task.link || '';
                    linkInput.placeholder = 'ุฑุงุจุท ุงูุชุณููู ุฃู ูุณุชูุฏ';
                    linkInput.addEventListener('change', () => {
                        task.link = linkInput.value.trim();
                        touchTask(task);
                        persistAndRender();
                    });
                    linkInput.disabled = !editable;
                    const openLink = document.createElement('button');
                    openLink.type = 'button';
                    openLink.className = 'btn btn-secondary btn-small';
                    openLink.textContent = 'ูุชุญ';
                    openLink.disabled = !task.link;
                    openLink.addEventListener('click', () => {
                        if (task.link) {
                            window.open(task.link, '_blank');
                        }
                    });
                    linkCell.append(linkInput, openLink);
                    row.appendChild(linkCell);

                    const updatedCell = document.createElement('td');
                    const updatedText = document.createElement('div');
                    updatedText.className = 'inline-note';
                    updatedText.textContent = formatDate(task.lastUpdated);
                    updatedCell.appendChild(updatedText);
                    row.appendChild(updatedCell);

                    const actionCell = document.createElement('td');
                    actionCell.appendChild(buildTaskActions(task));
                    row.appendChild(actionCell);

                    taskBody.appendChild(row);

                    // Card
                    const card = document.createElement('article');
                    card.className = 'task-card';
                    if (isUnassigned) {
                        card.classList.add('unassigned-card');
                    }
                    const header = document.createElement('div');
                    header.className = 'task-card-header';
                    const title = document.createElement('div');
                    title.className = 'task-title';
                    title.textContent = task.title;
                    const badge = createStatusBadge(task.status);
                    header.append(title, badge);

                    const ownerLine = document.createElement('p');
                    ownerLine.className = 'inline-note';
                    ownerLine.textContent = task.owner || '';

                    const assigneeLine = document.createElement('div');
                    assigneeLine.className = 'meta-line';
                    assigneeLine.innerHTML = `<strong>ุงููุณุคูู:</strong> ${task.assignee || 'โ'}`;

                    const notesBlock = document.createElement('div');
                    notesBlock.className = 'meta-line';
                    notesBlock.innerHTML = `<strong>ููุงุญุธุงุช:</strong> ${task.notes || 'โ'}`;
                    const reviewerBlock = document.createElement('div');
                    reviewerBlock.className = 'meta-line';
                    reviewerBlock.innerHTML = `<strong>ููุงุญุธุงุช ุงููุฑุงุฌุน:</strong> ${task.reviewerNotes || 'โ'}`;

                    const linkBlock = document.createElement('div');
                    linkBlock.className = 'meta-line';
                    linkBlock.innerHTML = `<strong>ุฑุงุจุท ุงูุชุณููู:</strong> ${task.link ? `<a href="${task.link}" target="_blank" rel="noopener">ูุชุญ</a>` : 'โ'}`;

                    const updatedLine = document.createElement('div');
                    updatedLine.className = 'inline-note';
                    updatedLine.textContent = `ุขุฎุฑ ุชุญุฏูุซ: ${formatDate(task.lastUpdated)}`;

                    const cardActions = document.createElement('div');
                    cardActions.className = 'card-actions';
                    const openBtn = document.createElement('button');
                    openBtn.type = 'button';
                    openBtn.className = 'btn btn-secondary btn-small';
                    openBtn.textContent = 'ูุชุญ ุงูุฑุงุจุท';
                    openBtn.disabled = !task.link;
                    openBtn.addEventListener('click', () => task.link && window.open(task.link, '_blank'));

                    const claimCardBtn = document.createElement('button');
                    claimCardBtn.type = 'button';
                    claimCardBtn.className = 'btn btn-primary btn-small';
                    claimCardBtn.textContent = 'ุงุณุชูุงู';
                    claimCardBtn.addEventListener('click', () => claimTask(task));
                    claimCardBtn.disabled = !claimable;

                    const unclaimCardBtn = document.createElement('button');
                    unclaimCardBtn.type = 'button';
                    unclaimCardBtn.className = 'btn btn-secondary btn-small';
                    unclaimCardBtn.textContent = 'ุฅูุบุงุก ุงูุงุณุชูุงู';
                    unclaimCardBtn.addEventListener('click', () => unclaimTask(task));
                    unclaimCardBtn.disabled = !editable;

                    const deleteCardBtn = document.createElement('button');
                    deleteCardBtn.type = 'button';
                    deleteCardBtn.className = 'btn btn-danger btn-small';
                    deleteCardBtn.textContent = 'ุญุฐู';
                    deleteCardBtn.addEventListener('click', () => deleteTask(task));
                    deleteCardBtn.disabled = !adminMode;

                    cardActions.append(openBtn, claimCardBtn, unclaimCardBtn, deleteCardBtn);

                    const cardPieces = [header, ownerLine, assigneeLine, notesBlock];
                    if (task.status === 'Review') {
                        cardPieces.push(reviewerBlock);
                    }
                    cardPieces.push(linkBlock, updatedLine, cardActions);

                    cardPieces.forEach(part => card.appendChild(part));
                    taskCards.appendChild(card);
                });

                backupText.value = '';
                updateStatusCounts();
                renderAdminGroups();
            }

            function renderAdminGroups() {
                adminGroupList.innerHTML = '';
                if (!tasks.length) {
                    const emptyState = document.createElement('p');
                    emptyState.className = 'inline-note';
                    emptyState.textContent = 'ูุง ุชูุฌุฏ ููุงู ุญุงููุงู.';
                    adminGroupList.appendChild(emptyState);
                    return;
                }

                const grouped = tasks.reduce((acc, task) => {
                    const key = task.assignee && task.assignee.trim() ? task.assignee.trim() : 'ุบูุฑ ูุณูุฏุฉ';
                    if (!acc[key]) acc[key] = [];
                    acc[key].push(task);
                    return acc;
                }, {});

                Object.keys(grouped).sort((a, b) => {
                    if (a === 'ุบูุฑ ูุณูุฏุฉ') return -1;
                    if (b === 'ุบูุฑ ูุณูุฏุฉ') return 1;
                    return a.localeCompare(b, 'ar');
                }).forEach(name => {
                    const wrapper = document.createElement('div');
                    wrapper.className = 'admin-group';
                    if (name === 'ุบูุฑ ูุณูุฏุฉ') {
                        wrapper.classList.add('admin-group-unassigned');
                    }

                    const header = document.createElement('div');
                    header.className = 'admin-group-header';
                    const title = document.createElement('h4');
                    title.textContent = `${name} (${grouped[name].length})`;
                    header.appendChild(title);
                    wrapper.appendChild(header);

                    const list = document.createElement('ul');
                    list.className = 'admin-task-list';
                    grouped[name].forEach(task => {
                        const item = document.createElement('li');
                        item.className = 'admin-task-item';
                        const nameLine = document.createElement('div');
                        nameLine.className = 'admin-task-title';
                        nameLine.textContent = task.title;
                        const meta = document.createElement('div');
                        meta.className = 'inline-note';
                        meta.textContent = `${statusLabels[task.status] || task.status} โข ${task.owner || 'ุจุฏูู ูุงูู'}`;
                        item.append(nameLine, meta);
                        list.appendChild(item);
                    });
                    wrapper.appendChild(list);
                    adminGroupList.appendChild(wrapper);
                });
            }

            function updateStatusCounts() {
                const totals = { All: tasks.length, New: 0, 'In Progress': 0, Review: 0, Delivered: 0 };
                tasks.forEach(task => {
                    if (totals.hasOwnProperty(task.status)) {
                        totals[task.status] += 1;
                    }
                });
                Object.keys(totals).forEach(key => {
                    if (counters[key]) {
                        counters[key].textContent = totals[key];
                    }
                });
            }

            function renderAccessCodes() {
                accessCodesList.innerHTML = '';
                ACCESS_CODES.forEach(code => {
                    const item = document.createElement('li');
                    item.className = 'code-item';
                    const text = document.createElement('span');
                    text.textContent = code;
                    const copyBtn = document.createElement('button');
                    copyBtn.type = 'button';
                    copyBtn.className = 'btn btn-primary btn-small';
                    copyBtn.textContent = 'ูุณุฎ';
                    copyBtn.addEventListener('click', () => copyToClipboard(code));
                    item.append(text, copyBtn);
                    accessCodesList.appendChild(item);
                });
            }

            function copyToClipboard(text, statusElement = copyStatus) {
                if (!text) return;
                navigator.clipboard.writeText(text).then(() => {
                    if (statusElement) {
                        statusElement.textContent = 'โ ุชู ุงููุณุฎ';
                        setTimeout(() => statusElement.textContent = '', 1200);
                    }
                }).catch(() => {
                    if (statusElement) {
                        statusElement.textContent = '';
                    }
                });
            }

            function renderPreLoginDiagnostics() {
                if (!normalizedPreview || !accessCodeCount || !storageKeyPreview) return;
                const normalizedValue = normalizeCode(accessCodeInput.value);
                normalizedPreview.textContent = normalizedValue || 'โ';
                accessCodeCount.textContent = ACCESS_CODES.length;
                storageKeyPreview.textContent = ACCESS_KEY;
            }

            function renderAccessDiagnostics() {
                if (!accessDiagnostics) return;
                const unlocked = hasAccess();
                accessDiagnostics.style.display = unlocked ? 'block' : 'none';
                diagnosticsList.innerHTML = '';

                const activeCodes = document.createElement('li');
                activeCodes.className = 'code-item';
                activeCodes.textContent = `ุงูุฑููุฒ ุงููุดุทุฉ: ${ACCESS_CODES.length}`;

                const adminState = document.createElement('li');
                adminState.className = 'code-item';
                adminState.textContent = adminMode ? 'ูุถุน ุงููุดุฑู: ููุนู' : 'ูุถุน ุงููุดุฑู: ุบูุฑ ููุนู';

                const storageItem = document.createElement('li');
                storageItem.className = 'code-item';
                storageItem.textContent = `ููุงุชูุญ ุงูุชุฎุฒูู: ${ACCESS_KEY}, ${TASK_KEY} (ูุง ูุชู ุชุฎุฒูู ูุถุน ุงููุดุฑู)`;

                diagnosticsList.append(activeCodes, adminState, storageItem);
            }

            function updateAdminUiState() {
                adminToggle.textContent = adminMode ? 'ูุถุน ุงููุดุฑู ููุนู' : 'ุชูุนูู ูุถุน ุงููุดุฑู';
                adminToggle.classList.toggle('active', adminMode);
                if (adminModeBadge) {
                    adminModeBadge.style.display = adminMode ? 'inline-flex' : 'none';
                }
                if (adminTaskBoard) {
                    adminTaskBoard.style.display = adminMode ? 'block' : 'none';
                }
                if (adminCodeSection) {
                    adminCodeSection.style.display = adminMode ? 'block' : 'none';
                }
                renderTasks();
                renderAdminTaskBoard();
                renderAccessDiagnostics();
            }

            function setAdminMode(value) {
                adminMode = !!value;
                updateAdminUiState();
            }

            function exportPayload() {
                return {
                    version: EXPORT_VERSION,
                    exportedAt: new Date().toISOString(),
                    tasks
                };
            }

            function handleImport(jsonText) {
                try {
                    const parsed = JSON.parse(jsonText);
                    const candidateTasks = Array.isArray(parsed) ? parsed : parsed.tasks;
                    if (!Array.isArray(candidateTasks)) {
                        throw new Error('ุตูุบุฉ ุบูุฑ ุตุงูุญุฉ: ูู ูุชู ุงูุนุซูุฑ ุนูู ูุงุฆูุฉ ููุงู.');
                    }
                    tasks = candidateTasks.map(task => normalizeTask(task));
                    persistAndRender();
                    importError.textContent = '';
                } catch (err) {
                    importError.textContent = err.message || 'ุชุนุฐุฑ ูุฑุงุกุฉ ุจูุงูุงุช JSON.';
                }
            }

            accessForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const providedCode = accessCodeInput.value;
                if (isValidAccessCode(providedCode)) {
                    persistAccessCode(providedCode);
                    showDashboard();
                } else {
                    accessCodeInput.value = '';
                    renderPreLoginDiagnostics();
                    alert('ุงูุฑูุฒ ุบูุฑ ุตุญูุญ.');
                }
            });

            accessCodeInput.addEventListener('input', renderPreLoginDiagnostics);

            resetAccess.addEventListener('click', function() {
                localStorage.removeItem(ACCESS_KEY);
                accessCodeInput.value = '';
                renderPreLoginDiagnostics();
                showGate();
            });

            addTaskBtn.addEventListener('click', function() {
                const title = newTitle.value.trim();
                if (!title) {
                    alert('ุงูุฑุฌุงุก ูุชุงุจุฉ ุนููุงู ูููููุฉ.');
                    return;
                }
                const owner = newOwner.value.trim();
                const status = newStatus.value;
                const newTask = normalizeTask({
                    id: Date.now(),
                    title,
                    owner,
                    status,
                    assignee: newAssignee.value.trim(),
                    notes: '',
                    reviewerNotes: '',
                    link: ''
                });
                touchTask(newTask);
                tasks.push(newTask);
                persistAndRender();
                newTitle.value = '';
                newOwner.value = '';
                newAssignee.value = '';
            });

            exportBtn.addEventListener('click', function() {
                const payload = exportPayload();
                backupText.value = JSON.stringify(payload, null, 2);
                navigator.clipboard.writeText(backupText.value).catch(() => {});
            });

            downloadBtn.addEventListener('click', function() {
                const payload = exportPayload();
                const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'tasks-backup.json';
                document.body.appendChild(link);
                link.click();
                link.remove();
                URL.revokeObjectURL(url);
            });

            importBtn.addEventListener('click', function() {
                if (!backupText.value.trim()) return;
                handleImport(backupText.value);
            });

            uploadFile.addEventListener('change', function() {
                const file = uploadFile.files && uploadFile.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => handleImport(e.target.result);
                reader.readAsText(file);
                uploadFile.value = '';
            });

            statusFilter.addEventListener('change', renderTasks);
            assigneeFilter.addEventListener('change', renderTasks);
            searchBox.addEventListener('input', renderTasks);
            sortBy.addEventListener('change', renderTasks);

            statusChips.forEach(chip => {
                chip.addEventListener('click', () => {
                    const status = chip.dataset.status;
                    statusFilter.value = status;
                    renderTasks();
                });
            });

            copyAllCodesBtn.addEventListener('click', () => copyToClipboard(ACCESS_CODES.join('\n')));

            copyAdminCodeBtn.addEventListener('click', () => copyToClipboard(ADMIN_MODE_CODE, adminCopyStatus));

            adminToggle.addEventListener('click', () => {
                const code = prompt('ุฃุฏุฎู ุฑูุฒ ุชูุนูู ูุถุน ุงููุดุฑู');
                if (code === null) return;
                if (isValidAdminCode(code)) {
                    setAdminMode(true);
                } else {
                    alert('ุฑูุฒ ุบูุฑ ุตุญูุญ.');
                }
            });

            if (hasAccess()) {
                showDashboard();
            } else {
                showGate();
            }
        })();
    </script>
</body>
</html>
